/**
 * Wix Code for Pet Page (adoptable-1 path)
 * This sends pet data to the embedded GitHub-hosted page
 * 
 * URL format: https://www.bigdogsdontcry.com/adoptable-1/{petId}
 * Original pages at /adoptable/{petId} remain unchanged
 */

$w.onReady(function () {
  $w('#dynamicDataset').onReady(() => {
    const petData = $w('#dynamicDataset').getCurrentItem();
    
    console.log('Pet data loaded for adoptable-1:', petData.Name, petData.Id);
    
    // Wait for iframe to load
    setTimeout(() => {
      sendPetDataToIframe(petData);
    }, 1000);

    // Also listen for ready message from iframe
    window.addEventListener('message', (event) => {
      if (event.data && event.data.type === 'PET_PAGE_READY') {
        console.log('Iframe ready, sending pet data');
        sendPetDataToIframe(petData);
      }
    });
  });
});

/**
 * Send pet data to the embedded iframe
 */
function sendPetDataToIframe(petData) {
  // Try multiple selectors to find the iframe
  let iframe = $w('#petPageFrame'); // If you set an ID in Wix
  
  // Fallback to querySelector if Wix element not found
  if (!iframe || !iframe.contentWindow) {
    iframe = document.querySelector('iframe[data-src*="github"], iframe[src*="github"], iframe[src*="bddc-pet-pages"]');
  }
  
  if (iframe && iframe.contentWindow) {
    // Send data to iframe
    iframe.contentWindow.postMessage({
      type: 'PET_DATA',
      pet: petData
    }, '*'); // In production, replace '*' with your GitHub Pages URL
    
    console.log('✅ Pet data sent to iframe:', petData.Name);
  } else {
    console.error('❌ Iframe not found. Make sure the iframe element exists on the page.');
    console.log('Looking for iframe with GitHub URL or ID "petPageFrame"');
  }
}
